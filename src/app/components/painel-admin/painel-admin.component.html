<p-confirm-dialog></p-confirm-dialog>
<p-toast></p-toast>

<div class="admin-container">
  <div class="admin-header">
    <div class="header-left">
      <i class="pi pi-shield admin-icon"></i>
      <h2>Painel do Administrador</h2>
    </div>
    <button
      pButton
      label="Sair"
      icon="pi pi-sign-out"
      class="p-button-rounded p-button-danger p-button-sm logout-btn"
      (click)="logout()"
    ></button>
  </div>

  <p-table
    [value]="empresas"
    dataKey="id"
    responsiveLayout="scroll"
    [loading]="loading"
    class="admin-table"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Empresa</th>
        <th>CNPJ</th>
        <th>E-mail</th>
        <th>Status</th>
        <th>Plano</th>
        <th>Vagas (usadas / limite)</th>
        <th>Ações</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-empresa>
      <tr>
        <!-- Empresa -->
        <td>
          <div class="empresa-info">
            <i class="pi pi-building empresa-icon"></i>
            <span class="empresa-nome">{{ empresa.nome }}</span>
          </div>
        </td>

        <!-- CNPJ -->
        <td>{{ formatarCnpj(empresa.cnpj) }}</td>

        <!-- E-mail -->
        <td>
          <span
            [ngClass]="empresa.emailConfirmado ? 'email-ok' : 'email-pendente'"
          >
            {{ empresa.emailConfirmado ? 'Confirmado' : 'Não confirmado' }}
          </span>
          <br />
          <small class="email-text">{{ empresa.email }}</small>
        </td>

        <!-- Status -->
        <td>
          <span [ngClass]="empresa.ativa ? 'status-ativo' : 'status-inativo'">
            {{ empresa.ativa ? 'Ativa' : 'Inativa' }}
          </span>
        </td>

        <!-- Plano -->
        <td><strong>{{ empresa.plano.titulo }}</strong></td>

        <!-- Vagas -->
        <td
          [ngClass]="
            empresa.totalVeiculos >= getLimiteVagasNumerico(empresa)
              ? 'limite-alcancado'
              : ''
          "
        >
          {{ empresa.totalVeiculos }} /
          {{
            empresa.limiteVagas === 'Ilimitado'
              ? 'Ilimitado'
              : empresa.limiteVagas
          }}
        </td>

        <!-- Ações -->
        <td class="acoes">
          @if (!empresa.emailConfirmado) {
          <p-button
            label="Confirmar E-mail"
            icon="pi pi-envelope"
            severity="success"
            variant="outlined"
            class="p-button-sm"
            (click)="confirmEmail($event, empresa.id)"
          ></p-button>
          }
          <p-button
            label="Renovar +30 dias"
            icon="pi pi-calendar-plus"
            class="p-button-sm"
            severity="info"
            (click)="confirmRenovarPlano($event, empresa.id)"
          ></p-button>
          <p-button
            label="Excluir"
            severity="danger"
            variant="outlined"
            icon="pi pi-trash"
            class="p-button-sm"
            (click)="confirmExcluirEmpresa($event, empresa.id)"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
